(function(){"use strict";const M=["sweet","spicy","sour","bitter","fresh"];function O(f){let n=0;for(const t in f)M.includes(t)&&(n+=f[t]);return n<120?0:n<240?1:n<350?2:n<700?3:n<960?4:5}const B=95;function I(f,n){const t={};for(const i in f)t[i]=f[i];for(const i in n)t[i]+=n[i];return t}function A(f,n){for(const t in f)if((n[t]??0)<f[t])return!1;return!0}function L(f,n,t,i,s){if(n&&f[i[0]]!=f[i[1]])return!1;for(const c in f)if(c in t){if(f[c]<t[c][0]||f[c]>t[c][1]||n&&!(c in i)&&f[c]>f[i[0]])return!1}else console.log(`${c} is not in flavorValues`);return!(O(f)<s[0]||O(f)>s[1])}function U(f,n,t,i){for(const s in f)if(s in n&&(f[s]<n[s][0]-B*i||f[s]>n[s][1]))return!0;return O(f)>t[1]}function X(f,n,t,i,s,c,g,_,E){const u=[],j=Object.fromEntries(M.map(o=>[o,0]));j.calories=0;function p(o){const e=f[o];let r=0;for(const h of M){const[l,k]=n[h];e[h]>0&&(r+=e[h]/Math.max(1,l))}return r}function Y(o,e){if(u.length===g&&e>u[0].score)return!1;for(let r=0;r<u.length;r++){const h=u[r],l=A(h.combo,o),k=A(o,h.combo);if(l&&!k||(k&&!l&&(u.splice(r,1),r--),l&&k))return!1}return u.push({combo:o,score:e}),u.sort((r,h)=>h.score-r.score),u.length>g&&(u.length=g),!0}const m=Object.keys(s).filter(o=>s[o]>0).sort((o,e)=>p(e)-p(o));function T(o,e,r,h,l){if(u.length===g&&e.calories>u[0].score)return;for(const y of u)if(A(y.combo,r))return;if(l>2&&L(e,_,n,t,i)){Y({...r},h);return}else if(l>0&&U(e,n,i,c-l))return;if(o>=m.length||l>=c)return;const k=m[o];let w=!1;for(const y of M)if(_||O(e)<i[0]||l<3||e[y]<n[y][0]&&f[k][y]>0){w=!0;break}w&&l<c&&(r[k]??0)<s[k]&&T(o,I(e,f[k]),{...r,[k]:(r[k]??0)+1},h+E(k),l+1),T(o+1,e,r,h,l)}return T(0,j,{},0,0),u.map(o=>o.combo)}self.onmessage=f=>{const{berryStats:n,flavorValues:t,rainbowFlavors:i,starRange:s,berryQuants:c,maxBerries:g,maxNumResults:_,enableRainbow:E}=f.data,j=X(n,t,i,s,c,g,_,E,p=>n[p].bitter+n[p].spicy+.5*n[p].fresh+1/3*(n[p].sweet+n[p].sour));self.postMessage(j)}})();
