(function(){"use strict";const g=["sweet","spicy","sour","bitter","fresh"];function j(n){return n<120?0:n<240?1:n<350?2:n<700?3:n<960?4:5}const A=[0,120,240,350,700,960,1/0],R=95,U=400;function X(n,f){const r={};for(const i in n)r[i]=n[i];for(const i in f)r[i]+=f[i];return r}function E(n,f){for(const r in n)if((f[r]??0)<n[r])return!1;return!0}function Y(n,f,r,i,e){if(f&&n[i[0]]!=n[i[1]])return!1;for(const s in n)if(s in r){if(n[s]<r[s][0]||n[s]>r[s][1]||f&&!(s in i)&&n[s]>n[i[0]])return!1}else if(s==="calories"){if(j(n[s])<e[0]||j(n[s])>e[1])return!1}else console.log(`${s} is not in flavorValues`);return!0}function m(n,f,r,i){for(const e in n)if(e in f){if(n[e]<f[e][0]-R*i||n[e]>f[e][1])return!0}else if(e==="calories"&&(n[e]<A[r[0]]-U*i||n[e]>A[r[1]+1]))return!0;return!1}function w(n,f,r,i,e,s,y,M,I){const u=[],O=Object.fromEntries(g.map(o=>[o,0]));O.calories=0;function p(o){const c=n[o];let t=0;for(const h of g){const[l,k]=f[h];c[h]>0&&(t+=c[h]/Math.max(1,l))}return t+=c.calories/Math.max(1,A[i[0]]),t}function $(o,c){if(u.length===y&&c>u[0].score)return!1;for(let t=0;t<u.length;t++){const h=u[t],l=E(h.combo,o),k=E(o,h.combo);if(l&&!k||(k&&!l&&(u.splice(t,1),t--),l&&k))return!1}return u.push({combo:o,score:c}),u.sort((t,h)=>h.score-t.score),u.length>y&&(u.length=y),!0}const B=Object.keys(e).filter(o=>e[o]>0).sort((o,c)=>p(c)-p(o));function T(o,c,t,h,l){if(u.length===y&&c.calories>u[0].score)return;for(const _ of u)if(E(_.combo,t))return;if(l>2&&Y(c,M,f,r,i)){$({...t},h);return}else if(l>0&&m(c,f,i,s-l))return;if(o>=B.length||l>=s)return;const k=B[o];let L=!1;for(const _ of g)if(M||l<3||c[_]<f[_][0]&&n[k][_]>0||c.calories<A[i[0]]){L=!0;break}L&&l<s&&(t[k]??0)<e[k]&&T(o,X(c,n[k]),{...t,[k]:(t[k]??0)+1},h+I(k),l+1),T(o+1,c,t,h,l)}return T(0,O,{},0,0),u.map(o=>o.combo)}self.onmessage=n=>{const{berryStats:f,flavorValues:r,rainbowFlavors:i,starRange:e,berryQuants:s,maxBerries:y,maxNumResults:M,enableRainbow:I}=n.data,O=w(f,r,i,e,s,y,M,I,p=>f[p].bitter+f[p].spicy+.5*f[p].fresh+1/3*(f[p].sweet+f[p].sour));self.postMessage(O)}})();
