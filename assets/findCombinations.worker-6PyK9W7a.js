(function(){"use strict";const M=["sweet","spicy","sour","bitter","fresh"];function O(f){let n=0;for(const t in f)M.includes(t)&&(n+=f[t]);return n<120?0:n<240?1:n<350?2:n<700?3:n<960?4:5}const B=95;function I(f,n){const t={};for(const i in f)t[i]=f[i];for(const i in n)t[i]+=n[i];return t}function A(f,n){for(const t in f)if((n[t]??0)<f[t])return!1;return!0}function L(f,n,t,i,s){if(n&&f[i[0]]!=f[i[1]])return!1;for(const l in f)if(l in t&&(f[l]<t[l][0]||f[l]>t[l][1]||n&&!(l in i)&&f[l]>f[i[0]]))return!1;return!(O(f)<s[0]||O(f)>s[1])}function U(f,n,t,i){for(const s in f)if(s in n&&(f[s]<n[s][0]-B*i||f[s]>n[s][1]))return!0;return O(f)>t[1]}function X(f,n,t,i,s,l,y,_,E){const c=[],j=Object.fromEntries(M.map(o=>[o,0]));j.calories=0;function p(o){const e=f[o];let r=0;for(const h of M){const[u,k]=n[h];e[h]>0&&(r+=e[h]/Math.max(1,u))}return r}function Y(o,e){if(c.length===y&&e>c[0].score)return!1;for(let r=0;r<c.length;r++){const h=c[r],u=A(h.combo,o),k=A(o,h.combo);if(u&&!k||(k&&!u&&(c.splice(r,1),r--),u&&k))return!1}return c.push({combo:o,score:e}),c.sort((r,h)=>h.score-r.score),c.length>y&&(c.length=y),!0}const m=Object.keys(s).filter(o=>s[o]>0).sort((o,e)=>p(e)-p(o));function T(o,e,r,h,u){if(c.length===y&&e.calories>c[0].score)return;for(const g of c)if(A(g.combo,r))return;if(u>2&&L(e,_,n,t,i)){Y({...r},h);return}else if(u>0&&U(e,n,i,l-u))return;if(o>=m.length||u>=l)return;const k=m[o];let w=!1;for(const g of M)if(_||O(e)<i[0]||u<3||e[g]<n[g][0]&&f[k][g]>0){w=!0;break}w&&u<l&&(r[k]??0)<s[k]&&T(o,I(e,f[k]),{...r,[k]:(r[k]??0)+1},h+E(k),u+1),T(o+1,e,r,h,u)}return T(0,j,{},0,0),c.map(o=>o.combo)}self.onmessage=f=>{const{berryStats:n,flavorValues:t,rainbowFlavors:i,starRange:s,berryQuants:l,maxBerries:y,maxNumResults:_,enableRainbow:E}=f.data,j=X(n,t,i,s,l,y,_,E,p=>n[p].bitter+n[p].spicy+.5*n[p].fresh+1/3*(n[p].sweet+n[p].sour));self.postMessage(j)}})();
